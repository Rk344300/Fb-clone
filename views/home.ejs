
<link rel="stylesheet" href="/css/home.css">


<div id="home-container">
<section id="feed-posts">
    <h4>Posts</h4>
    <% if(locals.user){ %>
    <form action="/posts/create" id="new-post-form"  enctype="multipart/form-data" method="POST">
        <textarea name="content" cols="30" rows="3" placeholder="Type Here..." required></textarea>
        <input type="file" name="postpic" placeholder="Post Image" required>
        <input type="submit" value="Post">
    </form>
    <% } %>

    <div id="posts-list-container">
        <ul>
            <% for(post of posts){ %>
                
                
                <%- include('_post') -%>
          
            <%} %>
        </ul>
    </div>
</section>



<section id="user-friends">
    <h4>Friends</h4>
   <% if(locals.user) { %>
    

  
    <% for(u of all_users){%>

       <% if(locals.user.id != u.id){ %>

         <p>
       
            <% if(sendList.includes(u.id)){ %>
               
                
               
                <a href="/users/profile/<%= u.id %>"><%= u.name %></a>
                &nbsp; 
                
                <a href="/users/profile/friends/cancel-request/<%= u.id %>"> Cancel Request </a>
        
                <!-- <i class="fa-solid fa-message <%= u.email %> <%= u.id %>"></i> -->
                <% } else if( receiveList.includes(u.id)){ %>

                   
                    <a href="/users/profile/<%= u.id %>"><%= u.name %></a>
                    &nbsp;
                    <a href="/users/profile/friends/accept-request/<%= u.id %>"> Accept Request </a>
                    OR 
                    <a href="/users/profile/friends/cancel-request/<%= u.id %>"> Cancel Request </a>
                    <!-- <i class="fa-solid fa-message <%= u.email %> <%= u.id %>"></i> -->
                    <% } else if( frndList.includes(u.id)){ %>
                       
                        <a href="/users/profile/<%= u.id %>"><%= u.name %></a>
                        &nbsp;
                        <a href="/users/profile/friends/cancel-request/<%= u.id %>"> Remove Friend </a>
                        <i class="fa-solid fa-message <%= u.email %> <%= u.id %>"></i>
                     <% } else { %>
            
                            <a href="/users/profile/<%= u.id %>"><%= u.name %></a>
                            &nbsp;&nbsp;
                            <a href="/users/profile/friends/send-request/<%= u.id%>">Add Friend</a>
    
            

       <% } %>
        </p> 
        
    <% }else { %>

      <a href="/users/profile/<%= u.id %>"><%= u.name %> | My Profile</a>
        <% } %> 

   <% } %>

        
    <% } else { %>
   <!-- IF USER is not logged in  -->

 <% for(u of all_users){%>

    <a href="/users/profile/<%= u.id %>"><%= u.name %></a>

    <% } %>
    <% } %>
</section> 

<%- include('_chat_box') -%>

</div>


<script src="/js/post_comment_reaction.js"></script>
<script>
    $('.toggle-like-button').each(function(){
        let self = this;
        let toggleLike = new HandleDiffReaction(self);
    });
</script> 

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"></script>
<script src="/js/chat_engine.js"></script>

<% if (locals.user){ %>
    <script>
        $('.fa-message').click(function(e){
            console.log("clicked",e.target.classList[2]);
            let receiverMail = e.target.classList[2];
            let receiverId = e.target.classList[3];
            $('#user-chat-box').css('display','block');
            console.log('user-chat-box', '<%= locals.user.email %>',receiverMail,receiverId,'<%= locals.user.id %>');
            new ChatEngine('user-chat-box', '<%= locals.user.email %>',receiverMail,receiverId,'<%= locals.user.id %>' );
           
        });
        
    </script>
    <% } %>
